<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Dynamic Analysis of RAT</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Dynamic Analysis of RAT</h1><br/><p>Copy name of executable and set Process Name is Rat.Unknown.exe (process name) and turn on inetsim</p><p></p><p>Operation is most useful column to filter on </p><p><img src="images/14-1.png" alt="images/14-1.png" /></p><p></p><p>Now we can see different operations such as create file, close file, query basic information </p><p><img src="images/14-2.png" alt="images/14-2.png" /></p><p>It looks like this file is querying different DLLs, which is normal </p><p></p><p>One of the strings we captured was the startup directory in AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup (persistance)</p><p></p><p>We can set the Path column to Path Contains AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup and uncheck Operation contains file </p><p></p><p><img src="images/14-3.png" alt="images/14-3.png" /></p><p></p><p>we can see that mscordll.exe is written to startup </p><p></p><p>note - in our get request during network analysis, we requested for msdorelib.exe (also as seen in strings analysis), not mscordll.exe</p><p>its also strange that something with dll in the name is an .exe </p><p></p><p>we can see it was sucessfuly written to disk </p><p><img src="images/14-4.png" alt="images/14-4.png" /></p><p></p><p>but since inetsim is up it is the default inetsim GUI binary </p><p><img src="images/14-5.png" alt="images/14-5.png" /></p><p></p><p>When a host needs to make a connection to another host, a connecting host needs to understand TCP and we can pick up on some TCP artifacts </p><p></p><p>Open socket for TCP connection on the host is what we will look for and we will use tcpview in the sysinternals suite </p><p></p><p><img src="images/14-6.png" alt="images/14-6.png" /></p><p>0.0.0.0 means its listening on all addresses on local port 5555</p><p></p><p>We can pivot to REMnux and start netcat (nc) - swiss army knife of networking </p><p><img src="images/14-7.png" alt="images/14-7.png" /></p><p>netcat -nv (no dns and verbose mode) listening (we saw listen in the “State column” in procmon) for 10.0.0.4 over port 5555</p><p></p><p>when we connect we are presented with some base64 encoded string</p><p><img src="images/14-8.png" alt="images/14-8.png" /></p><p>decode: </p><p><img src="images/14-9.png" alt="images/14-9.png" /></p><p></p><p>It looks like we have shell capabilities </p><p><img src="images/14-10.png" alt="images/14-10.png" /></p><p></p><p>we can also see that the program does handle errors </p><p><img src="images/14-11.png" alt="images/14-11.png" /></p><p></p><p>in procmon on the flare vm we can see a tcp send/receive when interacting with the shell in remnux </p><p><img src="images/14-12.png" alt="images/14-12.png" /></p><p></p><p>When we run whoami in the shell (on REMnux) we can see how Rat.Unknown interacts with the system using procmon </p><p><img src="images/14-13.png" alt="images/14-13.png" /></p><p></p><p>this malware is a bind shell that has command injection capability - Bind Shells have the listener running on the target and the attacker connects to the listener in order to gain remote access to the target system.</p></div>
</body>
</html>
