<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Hostbased Signatures (procmon)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Hostbased Signatures (procmon)</h1><br/><p>Start by loading procmon, part of sysinternals suite </p><p><img src="images/12-1.png" alt="images/12-1.png" /></p><p></p><p>Procmon will tell you information that a process is doing at any given moment </p><p>User the filter button and set the fitler to ProcessName is *Name of Malware* </p><p></p><p>Once we detonate the malware - </p><p>We get process name, PID, what the malware is doing (Operation) and the Path of the Operation </p><p>We can use the filter button again to filter on Operation and see things like - everything that contains a file)</p><p><img src="images/12-2.png" alt="images/12-2.png" /></p><p></p><p>In our static analysis of malware strings, we saw “C:\Users\Public\Documents\CR433101.dat.exe” and we can apply that as a filter “Path Contains CR433101.dat.exe”</p><p></p><p><img src="images/12-3.png" alt="images/12-3.png" /></p><p><img src="images/12-4.png" alt="images/12-4.png" /></p><p></p><p>Remember that anything pulled from the “internet” will be the default inetsim binary </p><p></p><p>Next step is to run the malware again but this time without internet (simulating a sandbox/no internet) so turn off inetsim in REMNux and run the malware again. This will make sure that we can indicate if the malware has an anti-sandbox protocol or a protocol that says “If the C2 domain does not exist/has been taken down, stop execution and delete yourself from disk” </p><p></p><p>Our strings search picked up on cmd.exe /C ping 1.1.1.1 -n 1 -w 3000 &gt; Nul &amp; Del /f /q &quot;%s&quot; which looks like it is reaching out to the internet to see if the malware is in a sandbox </p><p><img src="images/12-5.png" alt="images/12-5.png" /></p><p></p></div>
</body>
</html>
