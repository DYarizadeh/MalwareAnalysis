<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Analyzing Reverse Shell</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Analyzing Reverse Shell</h1><br/><p>Run Floss - doesn&#39;t look like there are any URLs, File names, File system paths, or IPs </p><p>(in this sample this malware recruits a common malware technique where strings are built at runtime instead of compile. strings might be coded as a variable and might not be assembled until runtime. skilled malware authors will not be hard coding binaries. more often than not they will not be hardcoded)</p><p>Run Pestudio - not many severly hostile functions. Maybe virtualprotect (look at google) </p><p>	strings - connect, select, send </p><p>	<img src="images/15-1.png" alt="images/15-1.png" /></p><p>Sigheck - low entropy (&lt;7)</p><p></p><p>Start up inetsim/wireshark in REMnux and Procmon in Flare</p><p>DNS request for </p><p><img src="images/15-2.png" alt="images/15-2.png" /></p><p>aaaaaaaaaaaaaaaaaaaa.kadusus.local (right click the name value and hit copy -&gt; value) - domain callout without http </p><p></p><p>we can use the hosts file to make the malware think the malware box is aaaaaaaaaaaaaaaaaaaa.kadusus.local</p><p></p><p>in commander (run as administrator) </p><p>nano c:\windows\system32\drivers\etc\hosts - same as /etc/hosts in linux and the local host will reference this file for domains before it uses DNS </p><p><img src="images/15-3.png" alt="images/15-3.png" /></p><p>hit ctrl + o and then enter to write, ctrl+x to exit </p><p></p><p>Now if we have something on this host that can respond to that traffic, we are tricking the malware into think it is talking to the homebase server, when it is really talking to us</p><p><img src="images/15-4.png" alt="images/15-4.png" /></p><p>we can see that the malware is reaching out over https port 443</p><p></p><p>(without hosts file edited) </p><p><img src="images/15-5.png" alt="images/15-5.png" /></p><p></p><p>We can now open netcat listener on 443 (-l = listen), since we saw this binary making a dns request out to what doesn&#39;t look like a second stage payload, we are going to *listen* on the outgoing port </p><p><img src="images/15-6.png" alt="images/15-6.png" /></p><p></p><p>And in procmon we can see that we now have an open socket </p><p><img src="images/15-7.png" alt="images/15-7.png" /></p><p></p><p></p><p>If we run whoami, in procmon we can see some tcp send/receives as well as a sucessful whoami </p><p><img src="images/15-8.png" alt="images/15-8.png" /></p><p></p><p>This looks like a reverse shell - In the reverse shell, the attacker has the listener running on his/her machine and the target connects to the attacker with a shell.</p></div>
</body>
</html>
